# 用户身份与能力
受到 20 世纪 70 年代计算机发展的影响，Linux 系统的设计初衷之一就是为了满足多个用户同时工作的需求，因此必须具备很好的安全性，尤其要确保单个服务的故障不会影响到整台服务器。在第 1 章中，我们学习了如何安装 Linux 系统，并特别强调了设置 root 管理员密码的重要性。这个 root 管理员就是存在于所有类 UNIX 系统中的超级用户，相当于 Windows 系统中的 administrator。它拥有最高的系统所有权，能够管理系统的各项功能，如添加/删除用户、启动/关闭服务进程、开启/禁用硬件设备等。

虽然以 root 管理员的身份工作时不会受到系统的限制，但正如俗话所说：“能力越大，责任越大。”一旦使用这个高能的 root 管理员权限执行了错误的命令，可能会直接毁掉整个系统。使用与否，确实需要好好权衡一下。

在学习过程中是否应使用 root 管理员权限来控制整个系统呢？对此，网络上有许多文章建议以普通用户的身份操作，这种方法更为安全，也更“无责任”。今天就要冒天下之大不韪给出自己的心得—强烈推荐大家在学习时使用root 管理员权限！

这种为 root 管理员正名的决绝态度在网络中应该是很罕见的，我之所以力荐 root 管理员权限，原因很简单。在 Linux 的学习过程中，如果使用普通用户身份进行操作，则在配置服务之后出现错误时，很难判断是系统自身的问题还是权限不足所致，这无疑会给大家的学习过程徒增坎坷。何况我们的实验环境是使用 VMware 虚拟机软件搭建的，可以将安装好的系统设置为一次快照，这样即便系统彻底崩溃，也可以在 5s 内快速还原出一台全新的系统，而不用担心数据丢失。

总之，刘遄老师在培训时都推荐每位学生使用 root 管理员权限来学习 Linux 系统，等到实际工作时再根据生产环境决定使用哪个用户权限—这更多是选择问题，而非技术性问题。

此外，许多图书或培训机构的老师会提到，Linux 系统中的管理员就是 root。这其实是错误的，Linux 系统的管理员之所以是 root，并不是因为它的名字叫 root，而是因为用户标识符UID（User IDentification）的数值为 0。在 Linux 系统中，UID 就像我们的身份证号码一样具有唯一性，因此可通过用户的 UID 值来判断用户身份。在 RHEL 10 系统中，用户身份有下面这些。

管理员（UID 为 0）：系统的管理员用户。

系统用户（UID 为 1～999）：为了避免某个服务程序的漏洞被黑客利用，Linux 系统默认由权限受限的独立系统用户来运行服务程序，从而有效限制可能的破坏范围。

普通用户（UID 从 1000 开始）：由管理员创建的用于日常工作的用户。

需要注意的是，UID 是不能冲突的，而且管理员创建的普通用户的 UID 默认是从 1000开始的（即使前面有闲置的号码）。

为了方便管理属于同一组的用户，Linux 系统中还引入了用户组的概念。借助于用户组标识符（GID，Group IDentification），可以把多个用户加入同一个组中，从而方便为组中的用户统一规划权限或指定任务。假设一个公司中有多个部门，每个部门中又有很多员工，如果只想让员工访问本部门内的资源，就可以针对部门（而非具体的员工）来设置权限。例如， 对技术部门设置权限，使得只有技术部门的员工允许访问公司的数据库信息等。

另外，在 Linux 系统中创建每个用户时，将自动创建一个与其同名的基本用户组（Primary Group），而且这个基本用户组中只有该用户一个人。如果该用户以后被纳入其他用户组，则这个其他用户组会被称为附加用户组（Supplementary Group）。一个用户只有一个基本用户组，但是允许有多个附加用户组，从而满足日常的工作需要。

Tips ：
基本用户组就像是原生家庭，是在创建账户（出生）时就自动生成的，终身只能有一个；而附加用户组则像工作单位，为了完成工作，需要加入到各个不同的群体中，这是需要手动添加的，可以有很多个。

## id命令

id 命令用于显示用户的详细信息，语法格式为“id 用户名”。

这个 id 命令是一个在管理用户的整个过程中都需要用到的命令，因此建议仔细学习， 它能够简单轻松地查看用户的基本信息，例如用户ID、基本用户组与附加用户组 GID，以便于我们判别某个用户是否已经存在，以及查看相关信息。

下面使用 id 命令查看一个名称为 linuxprobe 的用户信息：
```shell
root@linuxprobe:~# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),10(wheel)
```
## useradd命令

useradd 命令用于创建新的用户账户，语法格式为“useradd [参数] 用户名”。

使用 useradd 命令创建用户账户时，默认的用户家目录会被存放在/home 目录中，默认的 Shell 解释器为/bin/bash，而且默认会创建一个与该用户同名的基本用户组。这些默认设置可以根据表 5-1 中的 useradd 命令参数自行修改。

**useradd命令中的参数以及作用**
| 参数  |                   作用                   |
| :---: | :--------------------------------------: |
|  -d   | 指定用户的家目录（默认为/home/username） |
|  -e   |    账户的到期时间，格式为YYYY-MM-DD.     |
|  -u   |           指定该用户的默认UID            |
|  -g   |  指定一个初始的用户基本组（必须已存在）  |
|  -G   |         指定一个或多个扩展用户组         |
|  -N   |       不创建与用户同名的基本用户组       |
|  -s   |       指定该用户的默认Shell解释器        |

下面使用useradd 命令创建一个名称为linuxcool 的用户，并使用 id 命令确认信息：
```shell
root@linuxprobe:~# useradd linuxcool
root@linuxprobe:~# id linuxcool
uid=1001(linuxcool) gid=1001(linuxcool) groups=1001(linuxcool)
```
下面我们提高难度，创建一个普通用户并指定家目录的路径、用户的 UID 以及 Shell 解释器。在下面的命令中，请注意/sbin/nologin，它是终端解释器中的一员，与 Bash 解释器有着天壤之别。一旦用户的解释器被设置为 nologin，则代表该用户不能登录到系统中：
```shell
root@linuxprobe:~# useradd -d /home/linux -u 8888 -s /sbin/nologin linuxdown
root@linuxprobe:~# id linuxdown
uid=8888(linuxdown) gid=8888(linuxdown) groups=8888(linuxdown)
```
## groupadd命令

groupadd 命令用于创建新的用户组，语法格式为“groupadd [参数] 群组名”。为了更加高效地指派系统中各个用户的权限，在工作中常常会把几个用户加入到同一个

组中，这样便可以针对一类用户统一安排权限。例如在工作中成立一个部门组，当有新的同事加入时就把他的账户添加到这个部门组中，这样新同事的权限就自动跟其他同事一模一样了，从而省去了一系列烦琐的操作。

创建用户组的步骤非常简单，例如使用如下命令创建一个用户组 winston：
```shell
root@linuxprobe:~# groupadd winston
```
## usermod命令

usermod 命令用于修改用户的属性，英文全称为 user modify，语法格式为“usermod [参数] 用户名”。

前文曾反复强调，Linux 系统中的一切都是文件，因此在系统中创建用户也就是修改配置文件的过程。用户的信息保存在/etc/passwd 文件中，可以直接用文本编辑器来修改其中的用户参数项目，亦可以用 usermod 命令修改已经创建的用户信息，比如用户的 UID、基本/附加用户组、默认终端等。usermod 命令的参数以及作用如表 5-2 所示。

**usermod 命令中的参数以及作用**

| 参数  |                                 作用                                 |
| :---: | :------------------------------------------------------------------: |
|  -c   |                        填写用户账户的备注信息                        |
| -d -m | 参数-m 与参数-d 连用，可重新指定用户的家目录并自动把旧的数据转移过去 |
|  -e   |                  账户的到期时间，格式为 YYYY-MM-DD                   |
|  -g   |                            变更所属用户组                            |
|  -G   |                            变更附加用户组                            |
|  -L   |                        锁定用户禁止其登录系统                        |
|  -U   |                       解锁用户，允许其登录系统                       |
|  -s   |                             变更默认终端                             |
|  -u   |                            修改用户的 UID                            |

大家不要被这么多参数吓坏了。先来看一下账户linuxprobe 的默认信息：
```shell
root@linuxprobe:~# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),10(wheel)
```
然后将用户linuxprobe 加入到root 用户组中，这样附加用户组列表中则会出现root用户组的字样，而基本用户组不会受到影响：
```shell
root@linuxprobe:~# usermod -G root linuxprobe
root@linuxprobe:~# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),0(root)
```
再来试试用-u 参数修改 linuxprobe 用户的 UID：
```shell
root@linuxprobe:~# usermod -u 9999 linuxprobe
root@linuxprobe:~# id linuxprobe
uid=9999(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),0(root)
```
除此之外，同学们最关心的肯定是如果把用户的解释器终端由默认的/bin/bash 修改为/sbin/nologin 后会有什么样的效果。我们来试试吧：
```shell
root@linuxprobe:~# usermod -s /sbin/nologin linuxprobe
root@linuxprobe:~# su - linuxprobe
This account is currently not available.
```
效果很直观！将用户的终端设置成/sbin/nologin 后，用户马上就不能登录了（切换身份也不行），但这个用户依然能够被某个服务所调用，管理某个具体的服务。这样的好处是当黑客通过这个服务成功入侵系统后，破坏的范围也仅仅局限于这个特定的服务，而不能使用这个用户身份登录到整台服务器上，从而尽可能地把损失降至最小。

## passwd命令

passwd 命令用于修改用户的密码、过期时间等信息，英文全称为 password，语法格式为“passwd [参数] 用户名”。

普通用户只能使用 passwd 命令修改自己的系统密码，而 root 管理员则有权限修改其他所有人的密码。更酷的是，root 管理员在 Linux 系统中修改自己或他人的密码时不需要验证旧密码，这一点特别方便。既然 root 管理员能够修改其他用户的密码，就表示其完全拥有该用户的管理权限。passwd 命令中的参数以及作用如表 5-3 所示。

**passwd 命令中的参数以及作用**

|  参数   |                          作用                          |
| :-----: | :----------------------------------------------------: |
|   -l    |                  锁定用户，禁止其登录                  |
|   -u    |                 解除锁定，允许用户登录                 |
| --stdin |              允许通过标准输入修改用户密码              |
|   -d    |               使该用户可用空密码登录系统               |
|   -e    |              强制用户在下次登录时修改密码              |
|   -S    | 显示用户的密码是否被锁定，以及密码所采用的加密算法名称 |

要修改自己的密码，只需要输入命令后敲击回车键即可：
```shell
root@linuxprobe:~# passwd
New password: 此处输入密码值
Retype new password: 再次输入进行确认
passwd: password updated successfully
```
要修改其他人的密码，则需要先检查当前是否为 root 管理员权限，然后在命令后指定要修改密码的那位用户的名称：
```shell
root@linuxprobe:~# passwd linuxprobe
New password: 此处输入密码值
Retype new password: 再次输入进行确认
passwd: password updated successfully
```
如果觉得重复输入两次密码有些麻烦，可以使用--stdin 参数接收由管道符传入的标准输入信息，passwd 命令会将其作为指定用户的密码值—不仅方便，而且很适合在批处理脚本中进行调用。
```shell
root@linuxprobe:~# echo "NewPass0107" | passwd --stdin linuxprobe
Changing password for user linuxprobe.
passwd: all authentication tokens updated successfully.
```
假设你有位同事正在度假，而且假期很长，那么可以使用 passwd 命令禁止该用户登录系统，等假期结束回归工作岗位时，再使用该命令允许用户登录系统，而不是将其删除。这样既保证了这段时间内系统的安全，也避免了频繁添加、删除用户带来的麻烦。
```shell
root@linuxprobe:~# passwd -l linuxprobe
passwd: password changed.
root@linuxprobe:~# passwd -S linuxprobe
linuxprobe L 2025-03-13 0 99999 7 -1
```
在解锁时，记得也要使用管理员的身份；否则，如果普通用户也有锁定权限，系统肯定会乱成一锅粥：
```shell
root@linuxprobe:~# passwd -u linuxprobe
passwd: password changed.
root@linuxprobe:~# passwd -S linuxprobe
linuxprobe P 2025-03-13 0 99999 7 -1
```
## userdel命令

userdel 命令用于删除已有的用户账户，英文全称为 user delete，语法格式为“userdel [参数] 用户名”。

如果确认某位用户后续不会再登录到系统中，则可以通过 userdel 命令删除该用户的所有信息。在执行删除操作时，该用户的家目录默认会保留下来，此时可以使用-r 参数将其删除。userdel 命令的参数以及作用如表 5-4 所示。

**userdel 命令中的参数以及作用**
| 参数  |           作用           |
| :---: | :----------------------: |
|  -f   |       强制删除用户       |
|  -r   | 同时删除用户及用户家目录 |

在删除一个用户时，一般会建议保留他的家目录数据，以免有重要的数据被误删除。所以在使用 userdel 命令时可以不加参数，写清要删除的用户名就行：
```shell
root@linuxprobe:~# userdel linuxprobe
root@linuxprobe:~# id linuxprobe
id: ‘linuxprobe’: no such user
```
虽然此时该用户已被删除，但家目录数据会继续存放在/home 目录中，等确认未来不再使用时将其手动删除即可：
```shell
root@linuxprobe:~# cd /home
root@linuxprobe:/home# ls
linuxcool  linuxdown  linuxprobe
root@linuxprobe:/home# rm -rf linuxprobe
root@linuxprobe:/home# ls
linuxcool  linuxdown
```
原则上建议不要习惯性地添加-rf 参数，如果一定要彻底删除账户信息和家目录文件， 应当将删除操作拆解为两个独立的步骤：使用 userdel 命令删除用户账户；使用 rm 命令删除家目录文件，以此形成操作缓冲机制，避免因误操作导致数据不可逆丢失。就像夫妻吵架了，不要着急把两人的纪念品扔掉，要先冷静一下，如果后悔了，可以随时再回家（添加回账户），此时一切将照旧（文件资料还都在），没有任何损失。