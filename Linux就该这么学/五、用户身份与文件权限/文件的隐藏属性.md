# 文件的隐藏属性
Linux 系统中的文件除了具备一般权限和特殊权限之外，还有一种隐藏权限（即被隐藏起来的权限），默认情况下不能直接被用户发觉。有用户曾经在生产环境和 RHCE 考试题目中碰到过明明权限充足却无法删除某个文件的情况，或者仅能在日志文件中追加内容而不能修改或删除内容的情况，这在一定程度上阻止了黑客篡改系统日志的图谋，因此这种“奇怪” 的文件权限也保障了 Linux 系统的安全性。

既然叫隐藏权限，那么使用常规的 ls 命令肯定不能看到它的真面目。隐藏权限的专用设置命令是 chattr，专用查看命令是 lsattr。

## chattr命令

chattr 命令用于设置文件的隐藏权限，英文全称为 change attributes，语法格式为“chattr [参数] 文件名称”。

如果想要把某个隐藏功能添加到文件上，则需要在命令后面追加“+参数”，如果想要把某个隐藏功能移出文件，则需要追加“-参数”。chattr 命令中可供选择的隐藏权限参数非常丰富，具体如表 5-8 所示。

**chattr 命令中的隐藏权限参数及其作用**

| 参数  |                                            作用                                            |
| :---: | :----------------------------------------------------------------------------------------: |
|   i   | 无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容，而不能新建或删除文件 |
|   a   |                  仅允许补充（追加）内容，无法覆盖/删除内容（Append Only）                  |
|   S   |                           文件内容在变更后立即同步到磁盘（sync）                           |
|   s   |                 彻底从磁盘中删除，不可恢复（用零块填充原文件所在磁盘区域）                 |
|   A   |                       不再修改这个文件或目录的最后访问时间（Atime）                        |
|   b   |                                不再修改文件或目录的存取时间                                |
|   D   |                                    检查压缩文件中的错误                                    |
|   d   |                            使用 dump 命令备份时忽略本文件/目录                             |
|   c   |                                  默认将文件或目录进行压缩                                  |
|   u   |                    当删除该文件后依然保留其在磁盘中的数据，方便日后恢复                    |
|   t   |                           让文件系统支持尾部合并（tail-merging）                           |
|   x   |                                可以直接访问压缩文件中的内容                                |

为了让读者能够更好地见识隐藏权限的效果，我们先来创建一个普通文件，然后立即尝试删除（这个操作肯定会成功）：
```shell
root@linuxprobe:~# echo "for Test" > linuxprobe
root@linuxprobe:~# rm linuxprobe
rm: remove regular file 'linuxprobe'? y
```
实践是检验真理的唯一标准。如果你没有亲眼见证过隐藏权限强大功能的美妙，就一定不会相信原来 Linux 系统会如此安全。接下来再次新建一个普通文件，并为其设置“不允许删除与覆盖”（+a 参数）权限，然后再尝试将这个文件删除：
```shell
root@linuxprobe:~# echo "for Test" > linuxprobe
root@linuxprobe:~# chattr +a linuxprobe
root@linuxprobe:~# rm linuxprobe 
rm: remove regular file 'linuxprobe'? y
rm: cannot remove 'linuxprobe': Operation not permitted
```
可见，上述操作失败了。

## lsattr命令

lsattr 命令用于查看文件的隐藏权限，英文全称为 list attributes，语法格式为“lsattr [参数] 文件名称”。

在 Linux 系统中，文件的隐藏权限必须使用 lsattr 命令来查看，平时使用的 ls 之类的命令看不出端倪：

```shell
root@linuxprobe:~# ls -al linuxprobe
-rw-r--r--. 1 root root 9 Mar 13 13:20 linuxprobe
```
一旦使用 lsattr 命令后，文件上被赋予的隐藏权限马上就会原形毕露：
```shell
root@linuxprobe:~# lsattr linuxprobe
-----a---------------- linuxprobe
```
此时按照显示的隐藏权限的类型（字母），使用 chattr 命令将其去掉：
```shell
root@linuxprobe:~# chattr -a linuxprobe
root@linuxprobe:~# lsattr linuxprobe
---------------------- linuxprobe
root@linuxprobe:~# rm linuxprobe 
rm: remove regular file 'linuxprobe'? y
```
此时按照显示的隐藏权限的类型（字母），使用 chattr 命令将其去掉：
```shell
root@linuxprobe:~# chattr -a linuxprobe
root@linuxprobe:~# lsattr linuxprobe
---------------------- linuxprobe
root@linuxprobe:~# rm linuxprobe 
rm: remove regular file 'linuxprobe'? y
```
我们通常会将-a 参数设置到日志文件（如/var/log/messages）上，这样可在不影响系统正常写入日志的前提下，防止黑客擦除自己的作案证据。如果希望彻底地保护某个文件，不允许任何人修改和删除它的话，不妨加上-i 参数试试，效果特别好。

在美剧《越狱》的第一季中，主角迈克尔·斯科菲尔德把装有越狱计划的磁盘开窗扔进了湖中，结果在第二季被警探打捞出来恢复了数据，然后就有了第二季、第三季、第四季、第五季，有了他和哥哥的逃亡故事。所以，要想彻底删除某个文件，可以使用

+s 参数来保证其被删除后不可恢复—磁盘上的文件数据会被用零块重新填充，那就更保险了。