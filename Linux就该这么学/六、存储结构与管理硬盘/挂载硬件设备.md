# 挂载硬件设备
我们在用惯了 Windows 系统后，总觉得一切都是理所当然的，平时把 U 盘插入电脑后也从来没有考虑过 Windows 系统做了哪些事情，才使得我们可以访问 U 盘的数据。接下来我们会逐一学习在 Linux 系统中挂载和卸载存储设备的方法，以便大家更好地了解在 Linux 系统 中添加硬件设备的工作原理和流程。前面讲到，在拿到一块全新的磁盘存储设备后要先分区， 然后格式化，最后才能挂载并正常使用。“分区”和“格式化”大家以前经常听到，但“挂载” 又是什么呢？

刘遄老师在这里给你一个最简单、最贴切的解释：当用户需要使用磁盘设备或分区中的数据时，需要先将其与一个已存在的目录文件进行关联，这个关联动作就是“挂载”。下文将向读者逐步讲解如何使用磁盘设备，但是鉴于与挂载相关的理论知识比较复杂且重要，因此决定再拿出一个小节单独讲解，这次希望大家不仅要看懂，还要记住。

mount 命令用于挂载文件系统，格式为“mount [文件系统] [挂载目录]”。mount命令中可用的参数及作用如表 6-3 所示。挂载是在使用硬件设备前执行的最后一步操作。只需使用 mount 命令把磁盘设备或分区与一个目录文件进行关联，然后就能在这个目录中看到硬件设备中的数据了。对于比较新的Linux 系统来说，一般不需要使用-t 参数指定文件系统的类型，Linux 系统会自动进行判断。而 mount 中的-a 参数则会自动检查/etc/fstab 文件中有无被遗漏挂载的设备文件，如果有，则进行自动挂载操作。

**mount 命令中的参数及作用**

| 参数  |                 作用                  |
| :---: | :-----------------------------------: |
|  -a   | 挂载所有在/etc/fstab 中定义的文件系统 |
|  -t   |          指定文件系统的类型           |

例如，要把设备/dev/sdb2 挂载到/backup 目录，只需要在 mount 命令中填写设备与挂载目录参数就行，系统会自动判断要挂载文件的类型，命令如下：
```shell
root@linuxprobe:~# mount /dev/sdb2 /backup
```

如果在工作中要挂载一块网络存储设备，该设备的名字可能会变来变去，这样再写为 sdb 就不太合适了。这时推荐用UUID（Universally Unique IDentifier，通用唯一识别码）进行挂载操作。UUID 是一串用于标识每块独立磁盘的字符串，具有唯一性及稳定性，特别适合用来挂载网络设备。那么，怎么才能得知独立磁盘的 UUID 呢？答案是使用 blkid 命令。

blkid 命令用于显示设备的属性信息，英文全称为 block device id，语法格式为“blkid [设备名]”。使用 blkid 命令查询设备 UUID 的示例如下：

```shell
root@linuxprobe:~# blkid
/dev/sdb1: UUID="1ff63c74-090c-4fa9-a3fb-cfb029572819" TYPE="xfs"
/dev/sdb2: UUID="53f01fa2-2a23-4979-8add-8fe0df5b8947" TYPE="ext4"
………………省略部分输出信息………………
```

有了设备的 UUID 值之后，就可以用它挂载网络设备了：

root@linuxprobe:~# mount UUID=53f01fa2-2a23-4979-8add-8fe0df5b8947 /backup

虽然按照上面的方法执行 mount 命令后就能立即使用文件系统了，但系统在重启后挂载就会失效，也就是说需要每次开机后都手动挂载一下。这肯定不是我们想要的效果，如果想让硬件设备和目录永久地进行自动关联，就必须把挂载信息按照指定的填写格式“设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检”（各字段的意义见表 6-4）写入/etc/fstab 文件中。这个文件中包含着挂载所需的诸多信息，一旦配置好之后就能一劳永逸了。

**用于挂载信息的指定填写格式中，各字段所表示的意义**

|   字段   |                                   意义                                    |
| :------: | :-----------------------------------------------------------------------: |
| 设备文件 |                 一般为设备的路径+设备名称，也可以写 UUID                  |
| 挂载目录 |                   指定要挂载到的目录，需在挂载前创建好                    |
| 格式类型 | 指定文件系统的格式，比如 Ext3、Ext4、XFS、SWAP、iso9660（此为光盘设备）等 |
| 权限选项 | 若设置为 defaults，则默认权限为 rw、suid、dev、exec、auto、nouser、async  |
| 是否备份 |           若为 1 则开机后使用 dump 进行磁盘备份，为 0 则不备份            |
| 是否自检 |              若为 1 则开机后自动进行磁盘自检，为 0 则不自检               |

如果想将文件系统为 Ext4 的硬件设备/dev/sdb2 在开机后自动挂载到/backup 目录上，并保持默认权限且无须开机自检，就需要在/etc/fstab 文件中写入下面的信息，这样在系统重启后也会成功挂载。

```shell
root@linuxprobe:~# vim /etc/fstab
#
# /etc/fstab
# Created by anaconda on Wed Mar 12 19:35:26 2025
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
UUID=408f4a3d-a4d3-4a44-bb23-6988cdbd10bf /                  xfs     defaults        0 0
UUID=4cf8ecae-bcb6-4b1e-8001-968b33643a8a /boot              xfs     defaults        0 0
UUID=1FB8-9199                   /boot/efi        vfat    umask=0077,shortname=winnt 0 2
UUID=d936c726-45a7-4ca2-8932-c54f84a3d787 none               swap    defaults        0 0
/dev/sdb2                                 /backup            ext4    defaults        0 0
```

由于后面需要使用系统镜像制作 YUM/DNF 软件仓库，我们提前把光盘设备挂载到/media/cdrom 目录中。光盘设备的文件系统格式是 iso9660：

写入/etc/fstab 文件中的设备信息并不会立即生效，需要使用 mount -a 参数进行自动挂载：
```shell
root@linuxprobe:~# mount -a
```
df 命令用于查看已挂载的磁盘空间使用情况，英文全称为 disk free，语法格式为 df -h。如果想查看当前系统中设备的挂载情况，非常推荐大家试试 df 命令。它不仅能够列出

系统中正在使用的设备有哪些，还可以用-h 参数便捷地对存储容量进行“进位”操作。例如， 在遇到 10240K 的时候会自动进位写成 10M，非常方便我们的阅读。
```shell
root@linuxprobe:~# df -h
Filesystem             Size  Used Avail Use% Mounted on
/dev/mapper/rhel-root   17G  3.7G   13G  23% /
devtmpfs               4.0M     0  4.0M   0% /dev
tmpfs                  1.9G   84K  1.9G   1% /dev/shm
efivarfs               256K   56K  196K  23% /sys/firmware/efi/efivars
tmpfs                  776M  9.7M  767M   2% /run
tmpfs                  1.0M     0  1.0M   0% /run/credentials/systemd-journald.service
/dev/sr0               6.5G  6.5G     0 100% /media/cdrom
/dev/sda2              960M  272M  689M  29% /boot
/dev/sda1              599M  8.3M  591M   2% /boot/efi
/dev/sdb2              480M   20M  460M   4% /backup
```
对了！说到网络存储设备，建议在 fstab 文件挂载信息中加上_netdev 参数。加上后系统会在联网成功后再尝试挂载这块网络存储设备，从而避免了开机时间过长或失败的情况（第 17 章学习 iSCSI 技术时可以用上）。
```shell
root@linuxprobe:~# vim /etc/fstab
#
# /etc/fstab
# Created by anaconda on Wed Mar 12 19:35:26 2025
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
UUID=408f4a3d-a4d3-4a44-bb23-6988cdbd10bf /                 xfs     defaults         0 0
UUID=4cf8ecae-bcb6-4b1e-8001-968b33643a8a /boot             xfs     defaults         0 0
UUID=1FB8-9199                   /boot/efi        vfat    umask=0077,shortname=winnt 0 2
UUID=d936c726-45a7-4ca2-8932-c54f84a3d787 none              swap    defaults         0 0
/dev/sdb2                                  /backup          ext4    defaults,_netdev 0 0
/dev/cdrom                                 /media/cdrom   iso9660    defaults        0 0
```
挂载文件系统的目的是使用硬件资源，而卸载文件系统则意味不再使用硬件的设备资源。既然挂载操作就是将硬件设备与目录进行关联的动作，那么卸载操作只需要说明想要取消关联的设备文件或挂载目录的其中一项即可，一般不需要加其他额外的参数。

umount 命令用于卸载设备或文件系统，英文全称为 un mount，语法格式为“umount [设备文件/挂载目录]”。
```shell
root@linuxprobe:~# cd /media/cdrom
root@linuxprobe:/media/cdrom# umount /dev/cdrom
umount: /media/cdrom: target is busy.
root@linuxprobe:/media/cdrom# cd ~
root@linuxprobe:~# umount /dev/cdrom
root@linuxprobe:~# 
```
Tips ：
挂载操作就像两人去民政局登记结婚，双方需要同时到场，信息一旦登记到民政局的系统中，再想重婚（重复挂载某设备）可就不行喽。

最后再教给同学们一个小技巧。如果系统中磁盘特别多，分区特别多，时间一长都不知道它们是否处于使用状态，又或者是做了些什么。此时，就可以用 lsblk 命令以树状图的形式列举一下了。

lsblk 命令用于查看系统中如磁盘、分区、逻辑卷等块设备信息，英文全称为 list block devices，输入该命令后按回车键执行即可
```shell
root@linuxprobe:~# lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda             8:0    0   20G  0 disk 
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 18.4G  0 part 
  ├─rhel-root 253:0    0 16.4G  0 lvm  /
  └─rhel-swap 253:1    0    2G  0 lvm  [SWAP]
sdb             8:16   0   20G  0 disk 
├─sdb1          8:17   0    1G  0 part 
└─sdb2          8:18   0  500M  0 part 
sr0            11:0    1  6.5G  0 rom  
```

