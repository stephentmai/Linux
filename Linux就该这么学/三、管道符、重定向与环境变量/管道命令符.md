# 管道命令符
细心的读者肯定还记得在 2.6 节学习 tr 命令时曾经见到过一个名为管道符的东西。同时按下键盘上的 Shift 键和反斜杠（\）键即可输入管道符，其执行格式为“命令 A | 命令 B”。管道命令符的作用也可以用一句话概括为“把前一个命令原本要输出到屏幕的信息当作后一个命令的标准输入”，如图 3-2 所示。

![](img/2025-12-03-15-33-16.png)
管道符示意图

在 2.6 节讲解 grep 文本搜索命令时，我们通过匹配关键词/sbin/nologin 找出了所有被限制登录系统的用户。在学完本节内容后，完全可以把下面这两条命令合并为一条：
  找出被限制登录用户的命令是 grep /sbin/nologin /etc/passwd；
  统计文本行数的命令则是 wc -l。
现在要做的就是把 grep 文本搜索命令的输出值传递给wc 统计命令，即把原本要输出到屏幕的用户信息列表交给 wc 命令作进一步的加工，因此只需要把管道符放到两条命令之间即可，具体如下：
```shell
root@linuxprobe:~# grep /sbin/nologin /etc/passwd | wc -l
33
```
这简直是太方便了！这个管道符就像一个法宝，我们可以将它套用到其他不同的命令上，比如用翻页的形式查看/etc 目录中的文件列表及属性信息（这些内容默认会一股脑儿地显示到屏幕上，根本看不清楚）：
```shell
root@linuxprobe:~# ls -l /etc/ | more
total 1316
-rw-r--r--.  1 root                 root                     16 Mar  8 20:06 adjtime
-rw-r--r--.  1 root                 root                   1529 Nov 29  2023 aliases
drwxr-xr-x.  3 root                 root                     65 Mar  8 20:04 alsa
drwxr-xr-x.  2 root                 root                   4096 Mar  8 20:04 alternatives
-rw-r--r--.  1 root                 root                    541 Jun 24  2024 anacrontab
-rw-r--r--.  1 root                 root                     55 Jun 17  2024 asound.conf
-rw-r--r--.  1 root                 root                      1 Jun 24  2024 at.deny
drwxr-x---.  4 root                 root                    100 Mar  8 20:02 audit
--More--
```
在修改用户密码时，通常都需要输入两次密码以进行确认，这在编写自动化脚本时将成为一个非常致命的缺陷。通过把管道符和 passwd 命令的--stdin 参数相结合，可以用一条命令来完成密码重置操作：
```shell
root@linuxprobe:~# echo "linuxprobe" | passwd --stdin root
```
我们在第 2 章学习 ps 命令的时候，输入 ps aux 命令后屏幕信息呼呼闪过，根本找不到有用的信息。现在，我们将 ps、grep 与管道符三者巧妙结合，发挥各自的长处。下面只搜索与 bash 有关的进程信息：
```shell
root@linuxprobe:~# ps aux | grep bash
root        3272  0.1  0.1 230020  5552 pts/0    Ss   10:30   0:02 /usr/bin/bash
root        3953  0.0  0.0 227680  1948 pts/0    S+   10:58   0:00 grep --color=auto bash
```
大家千万不要误以为管道命令符只能在一个命令组合中使用一次。我们完全可以这样使用：“命令 A | 命令 B | 命令 C”。为了帮助读者进一步理解管道符的作用，刘遄老师在讲课时经常会把管道符描述成“任意门”。想必大家小时候都看过《哆啦 A 梦》动画片吧。哆啦A 梦（也就是常称的机器猫）经常为了取悦大雄而从口袋中掏出一件件宝贝，其中好多次就用到了任意门这个道具。其实，管道符就好像用于实现数据穿越的任意门，能够帮助提高工作效率，完成之前不敢想象的复杂工作。

Tips ：
曾经有位来自东北的同学用一个极为贴切的比喻生动诠释了管道符的原理：管道符就像烧烤摊的流水线作业，即第一个人负责切肉，第二个人接力串肉，第三个人负责烤制。每一步的产出都是下一步的原料，如同管道符将前一个命令的输出无缝输送给下一个命令处理，最终把处理结果完整交付给用户。

如果读者是一名 Linux 新手，可能会觉得上面的命令组合已经十分复杂了，但是具有运维经验的读者又会感觉如隔靴搔痒般不过瘾，他们希望能将这样方便的命令写得更高级一些，功能更强大一些。为了感谢各位读者的捧场和对本书的认可，当然要义不容辞地把技术拱手奉上。如果需要将管道符处理后的结果既输出到屏幕，又同时写入文件，则可以与 tee 命令结合使用。

下述命令将显示系统中所有与 bash 相关的进程信息，并同时输出到屏幕和文件中：
```shell
root@linuxprobe:~# ps aux | grep bash | tee result.txt
root        3272  0.1  0.1 230020  5552 pts/0    Ss   10:30   0:02 /usr/bin/bash
root        3961  0.0  0.0 227680  1884 pts/0    S+   10:58   0:00 grep --color=auto bash
root        3962  0.0  0.0 230020  3300 pts/0    D+   10:58   0:00 /usr/bin/bash
root@linuxprobe:~# cat result.txt
root        3272  0.1  0.1 230020  5552 pts/0    Ss   10:30   0:02 /usr/bin/bash
root        3961  0.0  0.0 227680  1884 pts/0    S+   10:58   0:00 grep --color=auto bash
root        3962  0.0  0.0 230020  3300 pts/0    D+   10:58   0:00 /usr/bin/bash
```